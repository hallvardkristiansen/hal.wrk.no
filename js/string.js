var newpoints = [
 [0, 0, 0, 0.1, 0, 0.2], 
 [0, 0.2, 0, 0.4, -0.1, 0.7], 
 [0, 0.3, -0.1, 0.6, -0.1, 1], 
 [0, 0, -0.1, 0.8, -0.2, 1.3], 
 [0, 0, -0.1, 0.9, -0.2, 1.4], 
 [-0.1, 0.5, -0.2, 1, -0.2, 1.5], 
 [-0.1, 0.5, -0.2, 1, -0.3, 1.4], 
 [-0.1, 0.5, -0.2, 0.9, -0.3, 1.3], 
 [0, 0, -0.2, 0.8, -0.3, 1.3], 
 [-0.1, 0.4, -0.3, 0.9, -0.4, 1.4], 
 [-0.2, 0.5, -0.3, 0.9, -0.6, 1.4], 
 [0, 0, -0.4, 0.9, -0.7, 1.4], 
 [-0.3, 0.4, -0.6, 0.9, -0.9, 1.3], 
 [-0.3, 0.4, -0.7, 0.8, -1.1, 1.1], 
 [-0.4, 0.3, -0.9, 0.7, -1.4, 0.9], 
 [-0.5, 0.3, -1, 0.5, -1.6, 0.6], 
 [-0.6, 0.2, -1.1, 0.2, -1.6, 0.1], 
 [-0.5, -0.1, -0.9, -0.3, -1.3, -0.6], 
 [-0.4, -0.3, -0.7, -0.6, -1, -1], 
 [-0.3, -0.4, -0.5, -0.8, -0.7, -1.3], 
 [0, 0, -0.4, -0.9, -0.5, -1.4], 
 [0, 0, -0.2, -0.9, -0.3, -1.2], 
 [0, 0, -0.1, -0.7, -0.2, -0.9], 
 [0, -0.2, 0, -0.3, 0, -0.3], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 1.3, -0.1, 2.5, -0.3, 3.6], 
 [-0.1, 1.1, -0.3, 2.2, -0.5, 3.3], 
 [-0.2, 1, -0.5, 2, -0.7, 2.9], 
 [-0.3, 0.9, -0.6, 1.7, -0.9, 2.5], 
 [-0.3, 0.7, -0.7, 1.4, -1.1, 2], 
 [0, 0, -0.8, 1.1, -1.2, 1.5], 
 [-0.4, 0.4, -0.9, 0.8, -1.4, 1], 
 [0, 0, -1, 0.4, -1.5, 0.5], 
 [-0.5, 0.1, -1, 0, -1.4, -0.1], 
 [-0.4, -0.2, -0.8, -0.4, -1.1, -0.7], 
 [-0.3, -0.3, -0.6, -0.7, -0.8, -1.1], 
 [-0.2, -0.4, -0.4, -0.8, -0.6, -1.3], 
 [0, 0, -0.3, -0.9, -0.4, -1.3], 
 [-0.1, -0.4, -0.2, -0.8, -0.3, -1.2], 
 [-0.1, -0.3, -0.1, -0.6, -0.1, -0.8], 
 [0, -0.2, 0, -0.3, 0, -0.3], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0.1, 0, 0.4], 
 [0, 0.3, 0, 0.7, 0, 1.2], 
 [0, 0.5, 0, 1.1, 0, 1.8], 
 [0, 0, 0, 1.5, 0, 2.3], 
 [0, 0.8, 0, 1.7, 0, 2.7], 
 [0, 0.9, 0, 1.9, 0, 2.9], 
 [0, 0, 0, 2, 0, 3], 
 [0, 0, 0, 2, -0.1, 3], 
 [0, 1, -0.1, 1.9, -0.2, 2.8], 
 [-0.1, 0.9, -0.2, 1.8, -0.4, 2.6], 
 [-0.1, 0.8, -0.3, 1.6, -0.5, 2.4], 
 [-0.2, 0.7, -0.4, 1.5, -0.6, 2.1], 
 [-0.2, 0.7, -0.4, 1.3, -0.6, 1.9], 
 [-0.2, 0.6, -0.4, 1.1, -0.6, 1.6], 
 [-0.2, 0.5, -0.4, 1, -0.6, 1.4], 
 [-0.2, 0.4, -0.3, 0.8, -0.4, 1.1], 
 [-0.1, 0.3, -0.3, 0.7, -0.6, 1.2], 
 [0, 0, -0.6, 1, -1.1, 1.6], 
 [-0.4, 0.6, -0.9, 1.2, -1.5, 1.9], 
 [-0.5, 0.6, -1.1, 1.3, -1.8, 2], 
 [-0.6, 0.7, -1.3, 1.3, -2.1, 2], 
 [0, 0, -1.5, 1.3, -2.3, 1.9], 
 [0, 0, -1.6, 1.1, -2.5, 1.6], 
 [-0.8, 0.5, -1.7, 0.9, -2.6, 1.2], 
 [-0.9, 0.3, -1.7, 0.7, -2.4, 1], 
 [-0.7, 0.3, -1.3, 0.7, -1.9, 1], 
 [-0.6, 0.3, -1, 0.7, -1.4, 1], 
 [0, 0, -0.8, 0.6, -1.1, 0.9], 
 [-0.3, 0.3, -0.5, 0.5, -0.7, 0.8], 
 [-0.2, 0.2, -0.4, 0.4, -0.5, 0.6], 
 [-0.1, 0.2, -0.2, 0.3, -0.2, 0.4], 
 [0, 0.1, -0.1, 0.1, -0.1, 0.1], 
 [-0.4, 0.9, -0.6, 1.7, -0.7, 2.4], 
 [-0.1, 0.7, -0.1, 1.4, -0.1, 2], 
 [0.1, 0.6, 0.2, 1.1, 0.4, 1.6], 
 [0.2, 0.5, 0.5, 0.9, 0.7, 1.2], 
 [0.3, 0.3, 0.6, 0.6, 0.9, 0.9], 
 [0.3, 0.2, 0.6, 0.4, 0.8, 0.6], 
 [0.3, 0.1, 0.5, 0.3, 0.6, 0.3], 
 [0, 0, 0.3, 0.1, 0.3, 0.1], 
 [1.2, 0.2, 2.3, 0.2, 3.3, 0.1], 
 [0.9, -0.1, 1.8, -0.4, 2.4, -0.8], 
 [0.7, -0.4, 1.3, -0.9, 1.8, -1.5], 
 [0.5, -0.6, 0.9, -1.2, 1.2, -1.9], 
 [0.3, -0.7, 0.5, -1.3, 0.7, -2], 
 [0.2, -0.6, 0.3, -1.2, 0.4, -1.8], 
 [0.1, -0.5, 0.1, -1, 0.1, -1.3], 
 [0, 0, 0, -0.5, 0, -0.5], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0, 0.1], 
 [0, 0.1, 0, 0.2, 0, 0.5], 
 [0, 0.2, 0, 0.5, 0, 0.9], 
 [0, 0, 0, 0.9, 0, 1.5], 
 [0, 0.6, 0, 1.4, 0, 2.3], 
 [0, 0.9, 0, 1.9, -0.1, 3.1], 
 [0, 0, -0.1, 2.6, -0.1, 4.1], 
 [0, 1.6, -0.1, 3.3, -0.2, 5.3], 
 [-0.1, 2, -0.2, 3.7, -0.5, 5.3], 
 [-0.2, 1.6, -0.5, 2.9, -0.9, 4.1], 
 [0, 0, -0.8, 2.2, -1.2, 3.1], 
 [-0.4, 0.9, -0.9, 1.6, -1.3, 2.2], 
 [-0.4, 0.6, -0.9, 1.1, -1.3, 1.5], 
 [-0.4, 0.4, -0.8, 0.7, -1.1, 0.9], 
 [0, 0, -0.6, 0.4, -0.8, 0.4], 
 [-0.2, 0.1, -0.3, 0.1, -0.3, 0.1], 
 [0, 0, -0.1, 0, -0.1, 0.1], 
 [0, 0, -0.2, 0.1, -0.4, 0.1], 
 [-0.2, 0, -0.4, 0.1, -0.6, 0.1], 
 [-0.2, 0, -0.5, 0, -0.7, 0], 
 [-0.3, 0, -0.5, -0.1, -0.8, -0.1], 
 [-0.3, -0.1, -0.6, -0.2, -0.9, -0.4], 
 [0, 0, -0.6, -0.4, -0.8, -0.7], 
 [-0.3, -0.3, -0.5, -0.6, -0.8, -1], 
 [-0.2, -0.4, -0.4, -0.7, -0.6, -1.2], 
 [-0.2, -0.4, -0.4, -0.9, -0.6, -1.4], 
 [0, 0, -0.3, -1.1, -0.5, -1.7], 
 [-0.2, -0.6, -0.3, -1.3, -0.4, -2], 
 [-0.1, -0.7, -0.2, -1.5, -0.3, -2.3], 
 [0, 0, -0.1, -1.7, -0.2, -2.6], 
 [0, -0.9, 0, -1.9, 0, -2.9], 
 [0, -1, 0.1, -2.1, 0.2, -3.2], 
 [0.1, -1.1, 0.3, -2.2, 0.4, -3.2], 
 [0.2, -1, 0.4, -1.9, 0.6, -2.7], 
 [0.2, -0.8, 0.5, -1.6, 0.8, -2.3], 
 [0.3, -0.7, 0.6, -1.3, 1, -1.9], 
 [0, 0, 0.7, -1.1, 1.1, -1.5], 
 [0.4, -0.4, 0.9, -0.8, 1.3, -1.1], 
 [0.5, -0.3, 1, -0.5, 1.5, -0.7], 
 [0.5, -0.2, 1.1, -0.3, 1.7, -0.3], 
 [0.6, 0, 1.2, 0, 1.7, 0.1], 
 [0.5, 0.1, 1, 0.3, 1.4, 0.6], 
 [0.4, 0.2, 0.8, 0.5, 1.1, 0.9], 
 [0.3, 0.3, 0.6, 0.7, 0.9, 1], 
 [0.3, 0.4, 0.5, 0.7, 0.7, 1], 
 [0.2, 0.3, 0.3, 0.6, 0.5, 0.9], 
 [0.1, 0.3, 0.2, 0.5, 0.3, 0.7], 
 [0.1, 0.2, 0.1, 0.2, 0.1, 0.2], 
 [-0.2, -0.7, -0.5, -1.4, -0.8, -2], 
 [-0.3, -0.6, -0.6, -1, -0.9, -1.4], 
 [-0.3, -0.4, -0.7, -0.7, -1, -1], 
 [-0.3, -0.3, -0.7, -0.5, -1, -0.6], 
 [-0.3, -0.2, -0.6, -0.3, -0.9, -0.4], 
 [-0.3, -0.1, -0.5, -0.1, -0.7, -0.2], 
 [0, 0, -0.4, 0, -0.5, 0], 
 [-0.1, 0, -0.2, 0, -0.2, 0], 
 [-0.9, 0, -1.7, 0.1, -2.4, 0.4], 
 [-0.7, 0.3, -1.4, 0.7, -2, 1.2], 
 [-0.6, 0.5, -1.1, 1.2, -1.6, 1.9], 
 [-0.5, 0.7, -0.9, 1.6, -1.2, 2.5], 
 [-0.4, 0.9, -0.7, 1.9, -0.9, 3], 
 [-0.3, 1.1, -0.5, 2.2, -0.6, 3.3], 
 [0, 0, -0.3, 2.4, -0.4, 3.6], 
 [-0.1, 1.2, -0.1, 2.5, -0.1, 3.7], 
 [0, 1.5, -0.1, 2.9, -0.2, 4.3], 
 [0, 0, -0.3, 2.6, -0.4, 3.7], 
 [-0.2, 1.1, -0.4, 2.2, -0.7, 3.1], 
 [0, 0, -0.6, 1.8, -0.9, 2.6], 
 [-0.3, 0.8, -0.7, 1.4, -1.1, 2], 
 [-0.4, 0.6, -0.8, 1.1, -1.2, 1.5], 
 [0, 0, -0.9, 0.7, -1.4, 1], 
 [-0.5, 0.2, -1, 0.4, -1.5, 0.5], 
 [0, 0, -1, 0, -1.4, -0.1], 
 [0, 0, -0.8, -0.4, -1.1, -0.7], 
 [-0.3, -0.3, -0.6, -0.7, -0.8, -1.1], 
 [-0.2, -0.4, -0.4, -0.8, -0.6, -1.3], 
 [0, 0, -0.3, -0.9, -0.4, -1.3], 
 [-0.1, -0.4, -0.2, -0.8, -0.3, -1.2], 
 [-0.1, -0.3, -0.1, -0.6, -0.1, -0.8], 
 [0, -0.2, 0, -0.3, 0, -0.3], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0.1, 0, 0.4], 
 [0, 0.3, 0, 0.7, 0, 1.2], 
 [0, 0.5, 0, 1.1, 0, 1.8], 
 [0, 0.7, 0, 1.5, 0, 2.3], 
 [0, 0.8, 0, 1.7, 0, 2.7], 
 [0, 0.9, 0, 1.9, 0, 2.9], 
 [0, 1, 0, 2, 0, 3], 
 [0, 1, 0, 2, -0.1, 3], 
 [0, 1, -0.1, 1.9, -0.2, 2.8], 
 [0, 0, -0.2, 1.8, -0.4, 2.6], 
 [-0.1, 0.8, -0.3, 1.6, -0.5, 2.4], 
 [-0.2, 0.7, -0.4, 1.5, -0.6, 2.1], 
 [-0.2, 0.7, -0.4, 1.3, -0.6, 1.9], 
 [-0.2, 0.6, -0.4, 1.1, -0.6, 1.6], 
 [0, 0, -0.4, 1, -0.6, 1.4], 
 [-0.2, 0.4, -0.3, 0.8, -0.4, 1.1], 
 [-0.1, 0.3, -0.3, 0.7, -0.6, 1.2], 
 [0, 0, -0.6, 1, -1.1, 1.6], 
 [-0.4, 0.6, -0.9, 1.2, -1.5, 1.9], 
 [-0.5, 0.6, -1.1, 1.3, -1.8, 2], 
 [-0.6, 0.7, -1.3, 1.3, -2.1, 2], 
 [-0.7, 0.6, -1.5, 1.3, -2.3, 1.9], 
 [-0.8, 0.6, -1.6, 1.1, -2.5, 1.6], 
 [-0.8, 0.5, -1.7, 0.9, -2.6, 1.2], 
 [-0.9, 0.3, -1.7, 0.7, -2.4, 1], 
 [-0.7, 0.3, -1.3, 0.7, -1.9, 1], 
 [-0.6, 0.3, -1, 0.7, -1.4, 1], 
 [-0.4, 0.3, -0.8, 0.6, -1.1, 0.9], 
 [0, 0, -0.5, 0.5, -0.7, 0.8], 
 [-0.2, 0.2, -0.4, 0.4, -0.5, 0.6], 
 [-0.1, 0.2, -0.2, 0.3, -0.2, 0.4], 
 [0, 0.1, -0.1, 0.1, -0.1, 0.1], 
 [-0.4, 0.9, -0.6, 1.7, -0.7, 2.4], 
 [0, 0, -0.1, 1.4, -0.1, 2], 
 [0.1, 0.6, 0.2, 1.1, 0.4, 1.6], 
 [0.2, 0.5, 0.5, 0.9, 0.7, 1.2], 
 [0.3, 0.3, 0.6, 0.6, 0.9, 0.9], 
 [0.3, 0.2, 0.6, 0.4, 0.8, 0.6], 
 [0.3, 0.1, 0.5, 0.3, 0.6, 0.3], 
 [0, 0, 0.3, 0.1, 0.3, 0.1], 
 [1.2, 0.2, 2.3, 0.2, 3.3, 0.1], 
 [0.9, -0.1, 1.8, -0.4, 2.4, -0.8], 
 [0.7, -0.4, 1.3, -0.9, 1.8, -1.5], 
 [0.5, -0.6, 0.9, -1.2, 1.2, -1.9], 
 [0.3, -0.7, 0.5, -1.3, 0.7, -2], 
 [0.2, -0.6, 0.3, -1.2, 0.4, -1.8], 
 [0.1, -0.5, 0.1, -1, 0.1, -1.3], 
 [0, 0, 0, -0.5, 0, -0.5], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0, 0.1], 
 [0, 0.1, 0, 0.2, 0, 0.5], 
 [0, 0.2, 0, 0.5, 0, 0.9], 
 [0, 0, 0, 0.9, 0, 1.5], 
 [0, 0.6, 0, 1.4, 0, 2.3], 
 [0, 0.9, 0, 1.9, -0.1, 3.1], 
 [0, 1.2, -0.1, 2.6, -0.1, 4.1], 
 [0, 0, -0.1, 3.3, -0.2, 5.3], 
 [0, 0, -0.2, 3.7, -0.5, 5.3], 
 [-0.2, 1.6, -0.5, 2.9, -0.9, 4.1], 
 [-0.4, 1.2, -0.8, 2.2, -1.2, 3.1], 
 [-0.4, 0.9, -0.9, 1.6, -1.3, 2.2], 
 [0, 0, -0.9, 1.1, -1.3, 1.5], 
 [-0.4, 0.4, -0.8, 0.7, -1.1, 0.9], 
 [0, 0, -0.6, 0.4, -0.8, 0.4], 
 [-0.2, 0.1, -0.3, 0.1, -0.3, 0.1], 
 [0, 0, -0.1, 0, -0.1, 0.1], 
 [-0.1, 0, -0.2, 0.1, -0.4, 0.1], 
 [-0.2, 0, -0.4, 0.1, -0.6, 0.1], 
 [-0.2, 0, -0.5, 0, -0.7, 0], 
 [-0.3, 0, -0.5, -0.1, -0.8, -0.1], 
 [0, 0, -0.6, -0.2, -0.9, -0.4], 
 [-0.3, -0.2, -0.6, -0.4, -0.8, -0.7], 
 [-0.3, -0.3, -0.5, -0.6, -0.8, -1], 
 [-0.2, -0.4, -0.4, -0.7, -0.6, -1.2], 
 [0, 0, -0.4, -0.9, -0.6, -1.4], 
 [-0.2, -0.5, -0.3, -1.1, -0.5, -1.7], 
 [-0.2, -0.6, -0.3, -1.3, -0.4, -2], 
 [-0.1, -0.7, -0.2, -1.5, -0.3, -2.3], 
 [-0.1, -0.8, -0.1, -1.7, -0.2, -2.6], 
 [0, -0.9, 0, -1.9, 0, -2.9], 
 [0, -1, 0.1, -2.1, 0.2, -3.2], 
 [0, 0, 0.3, -2.2, 0.4, -3.2], 
 [0.2, -1, 0.4, -1.9, 0.6, -2.7], 
 [0.2, -0.8, 0.5, -1.6, 0.8, -2.3], 
 [0.3, -0.7, 0.6, -1.3, 1, -1.9], 
 [0, 0, 0.7, -1.1, 1.1, -1.5], 
 [0.4, -0.4, 0.9, -0.8, 1.3, -1.1], 
 [0, 0, 1, -0.5, 1.5, -0.7], 
 [0.5, -0.2, 1.1, -0.3, 1.7, -0.3], 
 [0.6, 0, 1.2, 0, 1.7, 0.1], 
 [0.5, 0.1, 1, 0.3, 1.4, 0.6], 
 [0.4, 0.3, 0.8, 0.6, 1.2, 0.9], 
 [0.3, 0.3, 0.7, 0.7, 0.9, 1.1], 
 [0.3, 0.4, 0.5, 0.8, 0.7, 1.1], 
 [0.2, 0.4, 0.4, 0.7, 0.5, 1], 
 [0.1, 0.3, 0.2, 0.5, 0.3, 0.7], 
 [0.1, 0.2, 0.1, 0.3, 0.1, 0.3]
];

var scale = 1;
var toggle = true;
var initialized = false;

var origin = [200,100];
var isDown = false;
var cpos = [200, 100];

var currentVectors = [];
var startVectors = [];
var deltas = [];

var returninterval = false;

var size = {
  'x': 280,
  'y': 170
}

var stringsvg = d3.select("body").append("svg")
  .attr("width", 1000)
  .attr("height", 1000)
  .attr("tabindex", 1)
  .attr("id", "string");

var circle = stringsvg.append("circle")
  .attr("r", 78)
  .attr("cx", 149)
  .attr("cy", 119)
  .attr("class", "circle");

var bgd = createPath(newpoints, origin);

var bgpath = stringsvg.append("path")
  .attr("d", bgd)
  .attr("class", "blackline");
  
var path = stringsvg.append("path")
  .attr("class", "line");

var dot1 = stringsvg.append("circle")
  .attr("r", 2)
  .attr("cx", 133)
  .attr("cy", -8)
  .attr("class", "dot");

var dot2 = stringsvg.append("circle")
  .attr("r", 2)
  .attr("cx", 174)
  .attr("cy", -8)
  .attr("class", "dot");

var grab = stringsvg.append("circle")
  .attr("r", 2)
  .attr("cx", 200)
  .attr("cy", 100)
  .attr('opacity', 0)
  .attr("class", "grabber");

function createPath(linevectors, origin) {
  var returnstring = 'M' + origin[0] + ',' + origin[1];
  var pvector = [origin[0], origin[1]];
  var zero = origin;
  for (var i = 0; i < linevectors.length; i++) {
    var vector = linevectors[i].slice();
    currentVectors[i] = [zero[0] + vector[4], zero[1] + vector[5]];
    deltas[i] = getDelta(currentVectors[i], pvector);
    pvector = currentVectors[i];
    returnstring += 'C' + currentVectors[i][0] + ',' + currentVectors[i][1] + ',' + currentVectors[i][0] + ',' + currentVectors[i][1] + ',' + currentVectors[i][0] + ',' + currentVectors[i][1] + ' ';
    zero = currentVectors[i];
  }
  startVectors = currentVectors.slice();
  return returnstring;
}

function dragPath(cpos) {
  var pathd = 'M' + cpos[0] + ',' + cpos[1];
  for (var i = 0; i < currentVectors.length; i++) {
    var b1 = currentVectors[i];
    var a2 = (i > 0) ? currentVectors[i-1] : [cpos[0], cpos[1]];
    currentVectors[i] = getNewVector(b1, deltas[i], a2);
    pathd += 'C' + currentVectors[i][0] + ',' + currentVectors[i][1] + ',' + currentVectors[i][0] + ',' + currentVectors[i][1] + ',' + currentVectors[i][0] + ',' + currentVectors[i][1] + ' ';
  }
  return pathd;
}

function getOffset(p1, p2) {
  var xoffset = p1[0] - p2[0];
  var yoffset = p1[1] - p2[1];
  return [xoffset, yoffset];
}

function getDelta(p1, p2) {
  var off = getOffset(p1, p2);
  var delta = Math.sqrt((off[0] * off[0]) + (off[1] * off[1]));
  return [delta, off];
}

function scaleByDelta(d1, d2) {
  var factor = d1[0] / d2[0];
  return [d2[1][0] * factor, d2[1][1] * factor];
}

function getNewVector(b1, db1a1, a2) {
  var delta_b1a2 = getDelta(b1, a2);
  if (db1a1[0] < delta_b1a2[0]) {
    var err = scaleByDelta(db1a1, delta_b1a2);
    return [a2[0] + err[0], a2[1] + err[1]];
  } else {
    return b1;
  }
}

if (!initialized) {
  path.transition()
    .duration(300)
    .ease("sin-out")
    .attr("d", createPath(newpoints, origin));

  dot1.transition()
    .delay(700)
    .duration(200)
    .ease("elastic-in")
    .attr("cx", 133)
    .attr("cy", 95);
  dot2.transition()
    .delay(700)
    .duration(250)
    .ease("elastic-in")
    .attr("cx", 174)
    .attr("cy", 80);
    
  initialized = true;
}

function mousedown() {
  isDown = true;//(cpos[0] > origin[0] - 20 && cpos[0] < origin[0] + 20 && cpos[1] > origin[1] - 20 && cpos[1] < origin[1] + 20);
}
function mousemove() {
  if (isDown){
    cpos = d3.mouse(this);
    path.attr('d', dragPath(cpos));
  }
}
function mouseup() {
  cpos = d3.mouse(this);
  if (isDown) {
    isDown = false;
  }
}
stringsvg.on('mousedown', mousedown);
stringsvg.on('mousemove', mousemove);
stringsvg.on('mouseup', mouseup);